<!DOCTYPE html>
<html>
    <head>
        <title>Library</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w==" crossorigin="anonymous" />
        <link rel="stylesheet" href="style.css" type="text/css">
    </head>
    <body>
        <nav>
            <button class="logIn-btn">Log In</button>
            <button class="logOut-btn">Log Out</button>
        </nav>
        <header>
          <h1>My Library</h1>  
        </header>
        <div class="btn">
            <button class="new-book">New Book</button>
        </div>
        <div class="book-info appearance">
            <form class="book-form">
                <button class="remove">
                    <i class="far fa-times-circle"></i>
                </button>
                <h4>Add New Book</h4>
                <div class="inputs">
                    <div class="book-input">
                        <h5>Title</h5>
                        <input class="input-btns title" type="text" placeholder="Title">
                    </div>
                    <div class="book-input">
                        <h5>Author</h5>
                        <input class="input-btns author" type="text" placeholder="Author">
                    </div>
                    <div class="book-input">
                        <h5>Pages</h5>
                        <input class="input-btns pages" type="number" placeholder="Pages">
                    </div>
                    <div class="book-input">
                        <h5 class="read-header">Read</h5>
                        <input class="input-btns read-check" type="checkbox" placeholder="Pages">
                    </div>
                    <div class="book-submit">
                        <button class="submit-btn" type="submit">Add</button>
                    </div>
                </div>
            </form>
        </div>
        <div class="book-contain">
            <div class="book">
                <p class="book-name cycle">Life As We Knew It</p>
                <p class="author-name cycle">By: Beth Pfeffer</p>
                <p class="pages-num cycle">337 pages</p>
                <button class="read book-btn">Not Read</button>
                <button class="delete book-btn">Delete</button>
            </div>
            <div class="book">
                <p class="book-name cycle">Divergent</p>
                <p class="author-name cycle">By: Veronica Roth</p>
                <p class="pages-num cycle">487 pages</p>
                <button class="read book-btn">Not Read</button>
                <button class="delete book-btn">Delete</button>
            </div>
            <div class="book">
                <p class="book-name cycle">They Both Die at the End</p>
                <p class="author-name cycle">By: Adam Silvera</p>
                <p class="pages-num cycle">384 pages</p>
                <button class="read book-btn">Not Read</button>
                <button class="delete book-btn">Delete</button>
            </div>
        </div>
        <div class="contain-overlay"></div>
    </body>
    <script src="app.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.11.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.11.0/firebase-analytics.js";
        import { 
            getAuth, 
            GoogleAuthProvider, 
            onAuthStateChanged,
            signInWithPopup, 
            signOut
        } from "https://www.gstatic.com/firebasejs/9.11.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.11.0/firebase-firestore.js"

        const firebaseConfig = {
            apiKey: "AIzaSyClAHAAFHUoFWnCS2WKT4f3_2lF4APO3Lo",
            authDomain: "library-2974d.firebaseapp.com",
            projectId: "library-2974d",
            storageBucket: "library-2974d.appspot.com",
            messagingSenderId: "425784309642",
            appId: "1:425784309642:web:8d4ba0be0fb14ae7b87a73",
            measurementId: "G-PJY5803LEL"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app)

        const prov = new GoogleAuthProvider()
        const auth = getAuth()

        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.querySelector('.logIn-btn').style.display = 'none'
                document.querySelector('.logOut-btn').style.display = 'block'
                setData()
            } else {
                document.querySelector('.logIn-btn').style.display = 'block'
                document.querySelector('.logOut-btn').style.display = ''
            }
        })

        const setData = async () => {
            try {
                let data = await addDoc(collection(db, 'Book'), {
                    title: 'Name',
                    author: 'Author',
                    pages: 5,
                    read: false
                })
                console.log('DATA', data, 'ID:', data.id)

                let getData = await getDocs(collection(db, 'Book'))
                
                getData.forEach((book) => {
                    console.log('New Data', book.data())
                })
            } catch (error) {
                console.log(error)
            }
            
            // db.collection('Book').add({
            //     title: '',
            //     author: '',
            //     pages: '',
            //     read: ''
            // })

        }

        document.querySelector('.logIn-btn').addEventListener('click', () => {
            
            console.log(auth, prov)
            console.log('Protocol', window.location.protocol)
            signInWithPopup(auth, prov)
            .then((result) => {
                const credential = GoogleAuthProvider.credentialFromResult(result);
                const token = credential.accessToken;
                const user = result.user;
                console.log(result)
            }).catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
                const email = error.customData.email;
                const credential = GoogleAuthProvider.credentialFromError(error)
            })
        })

        document.querySelector('.logOut-btn').addEventListener('click', () => {
            signOut(auth)
        })
    </script>
</html>



